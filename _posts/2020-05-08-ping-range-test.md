---
published: true
layout: post
title: 同一ネットワーク内で応答のあるIPをシュッと調べる
category: tech
tags: [ping,infrastructure,tips,bash]
---


# これを読んで得られるもの

- 同一ネットワーク内で応答のあるIPを手早く調べる方法が得られる
  - IP管理を指定無くても範囲がわかれば出来る
  - 一秒以内くらいに解る

# 経緯

自分は、自宅のIPに関して…

- 厳密に管理はしたくない(から台帳とかはつけてない)
- 必要なトコだけは名前で引けるようにLAN内DNSサーバ(bind9)を運用している
- 大まかにつないでる機器ぐらいは解ってる

という状態で運用してるのですが…

- DNS調べるのが面倒
- DNS調べられたとしても「その機器が現在応答可能か」をsshで入って…とかしんどい
- DHCPで新たに振られたIPをDHCPサーバの払い出し履歴から調べる…のが面倒

で、都度bashでfor文書いて「pingを範囲分回してた」のですが、ping一発の応答が一秒程度かかるので、毎回「イラッ」としながら、結果を待っていました。

# やったこと

以下のスクリプトを作って実行しました。

<script src="https://gist.github.com/kazuhito-m/e9498937d81fdf55d67f9fa191507a50.js"></script>

結果例は、

```bash
応答のあったIP:192.168.1.1
応答のあったIP:192.168.1.8
応答のあったIP:192.168.1.253
```

みたいのが「一瞬で」でます。

一瞬で出るのは「 `&` でpingコマンドを同時並行で飛ばしている」からですが、「同時にpingが(上記例では)200個以上同一端末から飛ぶ」ので、会社とかでやると、ひょっとすると管理者が観てて「何事？」となるかもしれません。

# 所感

四半期に一回くらい「調べる必要にかられる」のですが、その都度history等で「前どうやったかな？」って調べてた上、おっそいループを待ってたのはムダでしたが、改善できて良かったです。

上記スクリプトは「path通ったトコ」に移動しときたいと思います。

(が、コマンド名自体忘れるのが俺なんですがw)