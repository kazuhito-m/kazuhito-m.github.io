---
published: true
layout: post
title: ubuntuを22.04にアップグレードした際にディスプレイが赤みがかるというかセピアになる
category: tech
tags: [ubuntu, upgrade, setting]
---

## これを読んで得られるもの

- Ubuntuを22.04にアップグレードした際のトラブルを解決できる
  - ディスプレイの色味が変わった場合の対処ができる

## Ubuntuをアップグレードしたのです

思い立ったように「あ、Ubuntuを上げよう」と思い、デスクトップ機のUbuntuを `20.04` から `22.04` へとアップグレードしました。

`do-release-upgrade` コマンドを使って無事アップグレード完了。

再起動して、無事立ち上がった…のですが…。

マルチにしている一つのディスプレイが、明らかに色味変わってしまいました。

今回は、そのトラブルシュートを書きます。

## 現象

自宅のデスクトップPC環境は、三枚のディスプレイを接続しており、ウチ左の一枚が、MITUBISHIのテレビをディスプレイとして使っています。

![三枚ディスプレイ](/images/2023-01-28-3display.jpg)

Ubuntuをアップグレードしてから、そのMITUBISHIのテレビに映る映像が、赤みがかってるというかセピアになるというか…明らかに色味が減って見にくくなっていました。

![テレビの色味が変！](/images/2023-01-28-color-flavor-changed.jpg)

上記の写真からは「全く伝わらない」気がしますが…本来「白」や「灰色」で見えてほしい箇所が、明らかに「薄い赤」な感じになっています。

## 試行錯誤

- ディスプレイコードの抜き差し
  - 時折、左のディスプレイが治るが、今度は右側のディスプレイに症状が出る
  - ディスプレイ間の「症状の交換」は行えても「交換」なだけで「症状が無くなる」はしない
  - 再起動すると元に戻る
- HDMIになっている左右のディスプレイの接続ポートを交換
- Ubuntuの 設定->ディスプレイ から、ディスプレイ配置、解像度、リフレッシュレート等を変更
- NVIDIAのグラボなので、 `ubuntu-drivers autoinstall` でドライバをインストール
- ログイン時のウィンドウマネージャを `GNOME` から `Unity` に変更
  - 色味が治る！
  - が「ディスプレイの設定が不可能(ディスプレイが繋がれてないような表示となる)」ので常用できない

などを行ってみましたが、解決しませんでした。

## 推測

1. ディスプレイコードの抜き指しで、症状が「ディスプレイ間を移動する」
2. 左右のディスプレイの接続ポートを交換しても「症状がディスプレイに付いていく」
3. ウィンドウマネージャの変更で「治っている状態がありえる」

ということから、

- ハードでなく、ソフトウェア
- ディスプレイごとの設定のようなもの

ではないか、と推測し、情報を探しました。

(といっても、UbuntuというOS/ディストリビューションを更新しただけで、ハードが破壊される…を疑うの難しいのですが)


## 原因・対処

Ubuntuの「設定」->「カラー」には「モニター・プリンタごとに色味を調整する機能」があります。

![設定の「カラー」の機能](/images/2023-01-28-ubuntu-coloer-profile-before.png)

この機能は「ブルーライトのカット」であるとか「ディスプレイ特性の平準化」のために、ディスプレイごとに「色味のプロファイル」を変更できる機能、のようです。

Ubuntuは、インストール時何も設定しなくとも、ディスプレイごとに最適なプロファイルを選んで設定してくれます。

今回、MITSUBISHIのテレビは `MEL_TV(FHD)モニター` という機器として扱われ、 `自動-MEL-TV(FHD)` という設定に成っていました。


ここを一度「プロファイルを削除」し、「プロファイル追加」->  `自動-TV` のプロファイルに変更したところ、期待通りの「元の色味」に戻りました。

![プロファイルの選択](/images/2023-01-28-ubuntu-coloer-profile-choice.png)
![プロファイル変更後](/images/2023-01-28-ubuntu-coloer-profile-after.png)

(後で試したのですが、「削除」だけしても期待の色味になりました。)

![テレビの色味が戻った](/images/2023-01-28-ubuntu-coloer-flavor-undo.jpg)

これまた、上記の写真からは「全く伝わらない(どころか今度は青く成りすぎて悪化しているかのように見える)」気がしますが…実際のディスプレイは色味がアップグレード前に戻り、見やすくなりました。

## 所管

Ubuntuは「メジャーバージョン間アップグレードを割とカジュアルにできるようになっている」ので、そこは素晴らしいと思います。

しかし、設定をカスタマイズを多くしてるのもあり、時折「上げたらおかしくなった」と言う事象に出会います。

それが「bootできなくなった」とか「主要アプリが動かなくなった」とかなら、もう腹くくって「データサルベージ & 最新版インストール」しますし、必然性があり諦めもつくのですが…。

今回のように「我慢したら使えるけど…微妙に不快」みたいなのが厄介でして。

トラブルシュートにさんざ時間を使った後、数ヶ月単位で「イヤだなぁ」と思いながら常用する羽目になります。

ですので、今回は「数時間で解決できた」ので、不快な目似合わず、かつアップグレードしたことを後悔せずに済み、精神衛生上良かったです。

## 参考資料

- Ubuntu 16.04LTS でディスプレイの色を赤っぽくするブルーライトカット設定が簡単だった話
  - <https://osima.jp/posts/ubuntu-blue-light-cut-settings>
- Ubuntu18.04.2 LTSに NVIDIA GeForce GTX 1050 Tiのドライバをインストールする
  - <https://qiita.com/t__nabe/items/3aa82513aabb9a8ce370>